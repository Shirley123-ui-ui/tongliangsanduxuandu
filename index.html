<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸‰ç»´äº¤äº’å¼ç‰©ç†æ¦‚å¿µå­¦ä¹ ï¼šé€šé‡ã€æ•£åº¦ã€æ—‹åº¦</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: linear-gradient(135deg, #0a1931 0%, #185adb 50%, #1e3c72 100%);
            color: #e0f7fa;
            min-height: 100vh;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            width: 100%;
        }
        
        header {
            text-align: center;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(15, 30, 60, 0.8);
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(64, 156, 255, 0.3);
            width: 100%;
        }
        
        h1 {
            font-size: clamp(1.5rem, 4vw, 2.8rem);
            margin-bottom: 10px;
            background: linear-gradient(90deg, #00d4ff, #0088ff, #0044ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            line-height: 1.2;
        }
        
        .subtitle {
            font-size: clamp(0.9rem, 2.5vw, 1.3rem);
            color: #90caf9;
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        .scene-selector {
            display: flex;
            flex-direction: column;
            background: rgba(20, 40, 80, 0.7);
            border-radius: 10px;
            padding: 8px;
            margin-bottom: 15px;
            width: 100%;
            gap: 8px;
        }
        
        @media (min-width: 768px) {
            .scene-selector {
                flex-direction: row;
                justify-content: center;
            }
        }
        
        .scene-btn {
            padding: 12px 15px;
            background: transparent;
            border-radius: 8px;
            border: none;
            color: #90caf9;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 70px;
            flex: 1;
        }
        
        .scene-btn:hover {
            background: rgba(0, 132, 255, 0.2);
        }
        
        .scene-btn.active {
            background: rgba(0, 132, 255, 0.4);
            color: #e0f7fa;
            box-shadow: 0 0 15px rgba(0, 132, 255, 0.5);
        }
        
        .scene-icon {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .scene-container {
            background: rgba(15, 30, 60, 0.9);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(64, 156, 255, 0.3);
            margin-bottom: 20px;
            display: none;
            width: 100%;
        }
        
        .scene-container.active {
            display: block;
        }
        
        .scene-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .scene-title {
            font-size: clamp(1.2rem, 3vw, 2rem);
            color: #00d4ff;
            flex: 1;
        }
        
        .scene-icon-large {
            font-size: 2rem;
            margin-left: 10px;
        }
        
        .scene-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        @media (min-width: 992px) {
            .scene-content {
                flex-direction: row;
                gap: 25px;
            }
        }
        
        .canvas-panel {
            flex: 2;
            position: relative;
            width: 100%;
        }
        
        .control-panel {
            flex: 1;
            background: rgba(20, 40, 80, 0.7);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            width: 100%;
        }
        
        h2 {
            color: #00d4ff;
            margin-bottom: 15px;
            font-size: clamp(1.3rem, 2.5vw, 1.6rem);
            border-bottom: 2px solid rgba(0, 212, 255, 0.4);
            padding-bottom: 5px;
        }
        
        h3 {
            color: #0088ff;
            margin: 12px 0 8px 0;
            font-size: clamp(1.1rem, 2vw, 1.3rem);
        }
        
        .slider-container {
            margin: 10px 0;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            color: #bbdefb;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 4px;
            background: linear-gradient(90deg, #1a2c5d, #2a3c6d);
            outline: none;
            -webkit-appearance: none;
            touch-action: manipulation;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #00d4ff;
            cursor: pointer;
            box-shadow: 0 0 8px rgba(0, 212, 255, 0.8);
        }
        
        .value-display {
            display: flex;
            justify-content: space-between;
            margin-top: 3px;
            font-size: 0.85rem;
            color: #00d4ff;
        }
        
        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 8px 0;
        }
        
        button {
            padding: 10px 12px;
            background: linear-gradient(135deg, #2a3c6d, #1a2c5d);
            color: #e0f7fa;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
            flex: 1;
            min-width: 100px;
            touch-action: manipulation;
        }
        
        button:hover {
            background: linear-gradient(135deg, #0088ff, #0044ff);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 136, 255, 0.3);
        }
        
        button.active {
            background: linear-gradient(135deg, #0088ff, #0044ff);
            box-shadow: 0 0 12px rgba(0, 136, 255, 0.5);
        }
        
        .concept-explanation {
            background: rgba(10, 30, 60, 0.7);
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
            line-height: 1.5;
            border-left: 4px solid #00d4ff;
            font-size: 0.85rem;
        }
        
        .concept-explanation p {
            margin-bottom: 8px;
            color: #bbdefb;
        }
        
        .concept-explanation strong {
            color: #00d4ff;
        }
        
        .instructions {
            background: rgba(20, 40, 80, 0.7);
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
            border: 1px solid rgba(0, 132, 255, 0.3);
            font-size: 0.85rem;
        }
        
        .instructions h3 {
            margin-top: 0;
        }
        
        .instructions ul {
            padding-left: 18px;
            margin-top: 6px;
        }
        
        .instructions li {
            margin-bottom: 6px;
            line-height: 1.4;
        }
        
        .footer {
            text-align: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid rgba(64, 156, 255, 0.3);
            color: #90caf9;
            font-size: 0.8rem;
            width: 100%;
        }
        
        canvas {
            width: 100%;
            height: 400px;
            background: #0a1429;
            border-radius: 8px;
            cursor: grab;
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.6);
            touch-action: none;
        }
        
        @media (min-height: 700px) {
            canvas {
                height: 450px;
            }
        }
        
        @media (min-width: 768px) {
            canvas {
                height: 500px;
            }
        }
        
        canvas:active {
            cursor: grabbing;
        }
        
        .measurement-display {
            background: rgba(10, 20, 40, 0.85);
            border-radius: 8px;
            padding: 12px;
            border: 1px solid rgba(64, 156, 255, 0.3);
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.5);
            margin-top: 10px;
            width: 100%;
        }
        
        @media (min-width: 992px) {
            .measurement-display {
                position: absolute;
                top: 15px;
                right: 15px;
                width: auto;
                min-width: 180px;
                margin-top: 0;
            }
        }
        
        .measurement-title {
            text-align: center;
            font-size: 1rem;
            color: #bbdefb;
            margin-bottom: 8px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.3);
            padding-bottom: 4px;
        }
        
        .measurement-value-container {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .measurement-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .measurement-label {
            font-size: 0.85rem;
            color: #90caf9;
        }
        
        .measurement-value {
            font-size: 1rem;
            color: #00d4ff;
            font-weight: bold;
            min-width: 70px;
            text-align: right;
        }
        
        .measurement-unit {
            font-size: 0.75rem;
            color: #90caf9;
            text-align: right;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
            padding: 8px;
            background: rgba(10, 20, 40, 0.5);
            border-radius: 6px;
            font-size: 0.75rem;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 3px;
            flex-shrink: 0;
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ–ï¼šè§¦æ‘¸å‹å¥½çš„æ»‘å— */
        .touch-slider {
            height: 40px;
            display: flex;
            align-items: center;
        }
        
        /* é˜²æ­¢ç§»åŠ¨ç«¯æ–‡å­—è¿‡å° */
        @media (max-width: 480px) {
            .btn-group {
                gap: 6px;
            }
            
            button {
                min-width: 80px;
                padding: 8px 10px;
                font-size: 0.8rem;
            }
            
            .instructions li {
                font-size: 0.8rem;
            }
        }
        
        /* å¹³æ¿ä¼˜åŒ– */
        @media (min-width: 768px) and (max-width: 1199px) {
            body {
                padding: 15px;
            }
            
            .scene-container {
                padding: 20px;
            }
            
            canvas {
                height: 450px;
            }
        }
        
        /* æ¡Œé¢ä¼˜åŒ– */
        @media (min-width: 1200px) {
            body {
                padding: 20px;
            }
            
            .scene-selector {
                padding: 10px;
            }
            
            .scene-btn {
                padding: 15px 20px;
            }
        }
        
        /* é«˜DPIå±å¹•ä¼˜åŒ– */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            button, input[type="range"] {
                border-width: 0.5px;
            }
        }
        
        /* é˜²æ­¢iOSç¼©æ”¾ */
        input, select, textarea {
            font-size: 16px;
        }
        
        /* ç§»åŠ¨ç«¯è§¦æ‘¸åé¦ˆä¼˜åŒ– */
        button:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ä¸‰ç»´äº¤äº’å¼ç‰©ç†æ¦‚å¿µå­¦ä¹ </h1>
            <p class="subtitle">é€šè¿‡ç›´è§‚çš„3Dæ¨¡å‹ç†è§£é€šé‡ã€æ•£åº¦å’Œæ—‹åº¦ | æ‹–æ‹½ã€æ—‹è½¬ã€è°ƒèŠ‚ï¼Œäº²èº«æ„Ÿå—ç‰©ç†æ¦‚å¿µ</p>
        </header>
        
        <div class="scene-selector">
            <button id="scene-flux" class="scene-btn active">
                <div class="scene-icon">ğŸŒŠ</div>
                <div>é€šé‡æ¨¡å‹ï¼šæ¸”ç½‘ä¸æ°´æµé‡</div>
            </button>
            <button id="scene-divergence" class="scene-btn">
                <div class="scene-icon">ğŸš°</div>
                <div>æ•£åº¦æ¨¡å‹ï¼šæ°´é¾™å¤´ä¸æº/æ±‡</div>
            </button>
            <button id="scene-curl" class="scene-btn">
                <div class="scene-icon">ğŸŒ€</div>
                <div>æ—‹åº¦æ¨¡å‹ï¼šæ°´é¾™å·ä¸æ¼©æ¶¡</div>
            </button>
        </div>
        
        <!-- é€šé‡åœºæ™¯ -->
        <div id="flux-scene" class="scene-container active">
            <div class="scene-header">
                <div class="scene-title">é€šé‡æ¨¡å‹ï¼šæ¸”ç½‘ä¸æ°´æµé‡</div>
                <div class="scene-icon-large">ğŸŒŠ</div>
            </div>
            
            <div class="scene-content">
                <div class="canvas-panel">
                    <h2>ä¸‰ç»´äº¤äº’è§†å›¾</h2>
                    <canvas id="flux-canvas" width="800" height="500"></canvas>
                    
                    <div class="measurement-display">
                        <div class="measurement-title">æµ‹é‡ç»“æœ</div>
                        <div class="measurement-value-container">
                            <div class="measurement-row">
                                <div class="measurement-label">é€šé‡å€¼</div>
                                <div class="measurement-value" id="flux-value">0.00</div>
                            </div>
                            <div class="measurement-unit" id="flux-unit">å•ä½/ç§’</div>
                            
                            <div class="measurement-row">
                                <div class="measurement-label">æ°´æµå¯†åº¦</div>
                                <div class="measurement-value" id="flow-density-value">15</div>
                            </div>
                            <div class="measurement-unit">ç®­å¤´æ•°</div>
                            
                            <div class="measurement-row">
                                <div class="measurement-label">æ¸”ç½‘é¢ç§¯</div>
                                <div class="measurement-value" id="net-area-value">16.00</div>
                            </div>
                            <div class="measurement-unit">å¹³æ–¹ç±³</div>
                        </div>
                    </div>
                    
                    <div class="instructions">
                        <h3>äº¤äº’æŒ‡å—</h3>
                        <ul>
                            <li><strong>æ—‹è½¬è§†å›¾</strong>ï¼šè§¦æ‘¸å¹¶æ‹–æ‹½å¯ä»¥æ—‹è½¬æ•´ä¸ªåœºæ™¯</li>
                            <li><strong>è°ƒæ•´æ°´æµ</strong>ï¼šä½¿ç”¨ä¸‹æ–¹æ§åˆ¶é¢æ¿è°ƒæ•´æ°´æµæ–¹å‘å’Œå¯†åº¦</li>
                            <li><strong>è°ƒæ•´æ¸”ç½‘</strong>ï¼šæ§åˆ¶æ¸”ç½‘çš„æ–¹å‘å’Œå¤§å°</li>
                            <li><strong>è§‚å¯Ÿé€šé‡</strong>ï¼šè§‚å¯Ÿè“è‰²æ°´æµç®­å¤´ç©¿è¿‡çº¢è‰²æ¸”ç½‘çš„æƒ…å†µï¼Œé€šé‡å€¼å®æ—¶æ›´æ–°</li>
                            <li><strong>é€šé‡è§„åˆ™</strong>ï¼šåªæœ‰æ°´æµç®­å¤´æ­£åœ¨ç©¿è¿‡æ¸”ç½‘æ—¶æ‰ä¼šè®¡å…¥é€šé‡è®¡ç®—</li>
                        </ul>
                    </div>
                    
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #2196f3;"></div>
                            <span>æ°´æµæ–¹å‘</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #f44336;"></div>
                            <span>æ¸”ç½‘ï¼ˆæµ‹é‡æ›²é¢ï¼‰</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #4caf50;"></div>
                            <span>æ­£é€šé‡ï¼ˆæ°´æµç©¿è¿‡æ¸”ç½‘ï¼‰</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #ff9800;"></div>
                            <span>è´Ÿé€šé‡ï¼ˆæ°´æµåå‘ç©¿è¿‡ï¼‰</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #ff4081;"></div>
                            <span>ç©¿è¿‡ä¸­çš„æ°´æµ</span>
                        </div>
                    </div>
                </div>
                
                <div class="control-panel">
                    <h2>æ§åˆ¶é¢æ¿</h2>
                    
                    <h3>æ°´æµæ§åˆ¶</h3>
                    <div class="slider-container">
                        <label for="flow-density">æ°´æµå¯†åº¦ï¼š<span id="flow-density-display">15</span></label>
                        <input type="range" id="flow-density" min="1" max="50" step="1" value="15">
                    </div>
                    
                    <div class="slider-container">
                        <label for="flow-plane">æ°´æµå¹³é¢é«˜åº¦ï¼š<span id="flow-plane-display">0.0</span></label>
                        <input type="range" id="flow-plane" min="-3" max="3" step="0.1" value="0.0">
                    </div>
                    
                    <div class="slider-container">
                        <label for="flow-direction-x">æ°´æµXæ–¹å‘ï¼š<span id="flow-direction-x-value">0.7</span></label>
                        <input type="range" id="flow-direction-x" min="-1" max="1" step="0.1" value="0.7">
                    </div>
                    
                    <div class="slider-container">
                        <label for="flow-direction-y">æ°´æµYæ–¹å‘ï¼š<span id="flow-direction-y-value">0.5</span></label>
                        <input type="range" id="flow-direction-y" min="-1" max="1" step="0.1" value="0.5">
                    </div>
                    
                    <div class="slider-container">
                        <label for="flow-direction-z">æ°´æµZæ–¹å‘ï¼š<span id="flow-direction-z-value">0.3</span></label>
                        <input type="range" id="flow-direction-z" min="-1" max="1" step="0.1" value="0.3">
                    </div>
                    
                    <div class="btn-group">
                        <button id="flow-horizontal">æ°´å¹³æ°´æµ</button>
                        <button id="flow-vertical">å‚ç›´æ°´æµ</button>
                        <button id="flow-diagonal">å¯¹è§’çº¿æ°´æµ</button>
                    </div>
                    
                    <h3>æ¸”ç½‘æ§åˆ¶</h3>
                    <div class="slider-container">
                        <label for="net-size">æ¸”ç½‘å¤§å°ï¼š<span id="net-size-value">4.0</span></label>
                        <input type="range" id="net-size" min="2" max="8" step="0.1" value="4.0">
                    </div>
                    
                    <div class="slider-container">
                        <label for="net-position">æ¸”ç½‘ä½ç½®ï¼š<span id="net-position-value">0.0</span></label>
                        <input type="range" id="net-position" min="-3" max="3" step="0.1" value="0.0">
                    </div>
                    
                    <div class="slider-container">
                        <label for="net-rotation-x">æ¸”ç½‘Xæ—‹è½¬ï¼š<span id="net-rotation-x-value">0</span>Â°</label>
                        <input type="range" id="net-rotation-x" min="-90" max="90" step="1" value="0">
                    </div>
                    
                    <div class="slider-container">
                        <label for="net-rotation-y">æ¸”ç½‘Yæ—‹è½¬ï¼š<span id="net-rotation-y-value">0</span>Â°</label>
                        <input type="range" id="net-rotation-y" min="-90" max="90" step="1" value="0">
                    </div>
                    
                    <div class="slider-container">
                        <label for="net-rotation-z">æ¸”ç½‘Zæ—‹è½¬ï¼š<span id="net-rotation-z-value">0</span>Â°</label>
                        <input type="range" id="net-rotation-z" min="-180" max="180" step="1" value="0">
                    </div>
                    
                    <div class="btn-group">
                        <button id="net-horizontal">æ°´å¹³æ¸”ç½‘</button>
                        <button id="net-vertical">å‚ç›´æ¸”ç½‘</button>
                        <button id="net-tilted">å€¾æ–œæ¸”ç½‘</button>
                        <button id="net-reset-angle">é‡ç½®è§’åº¦</button>
                    </div>
                    
                    <div class="concept-explanation">
                        <p><strong>é€šé‡ï¼ˆFluxï¼‰</strong>æ˜¯çŸ¢é‡åœºç©¿è¿‡ä¸€ä¸ªæ›²é¢çš„æ€»é‡ã€‚</p>
                        <p>åœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼š</p>
                        <p>â€¢ <strong>è“è‰²ç®­å¤´</strong>è¡¨ç¤ºæ°´æµæ–¹å‘å’Œå¯†åº¦</p>
                        <p>â€¢ <strong>çº¢è‰²ç½‘æ ¼</strong>è¡¨ç¤ºæ¸”ç½‘ï¼ˆæµ‹é‡æ›²é¢ï¼‰</p>
                        <p>â€¢ <strong>ç²‰è‰²ç®­å¤´</strong>è¡¨ç¤ºæ­£åœ¨ç©¿è¿‡æ¸”ç½‘çš„æ°´æµ</p>
                        <p>â€¢ <strong>é€šé‡å€¼</strong>è¡¨ç¤ºå•ä½æ—¶é—´å†…ç©¿è¿‡æ¸”ç½‘çš„æ°´é‡</p>
                        <p>â€¢ æ°´æµå‚ç›´ç©¿è¿‡æ¸”ç½‘æ—¶é€šé‡æœ€å¤§ï¼Œå¹³è¡Œæ—¶é€šé‡ä¸ºé›¶</p>
                        <p>â€¢ <strong>åªæœ‰æ­£åœ¨ç©¿è¿‡æ¸”ç½‘çš„æ°´æµæ‰ä¼šäº§ç”Ÿé€šé‡</strong></p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ•£åº¦åœºæ™¯ -->
        <div id="divergence-scene" class="scene-container">
            <div class="scene-header">
                <div class="scene-title">æ•£åº¦æ¨¡å‹ï¼šæ°´é¾™å¤´ä¸æº/æ±‡</div>
                <div class="scene-icon-large">ğŸš°</div>
            </div>
            
            <div class="scene-content">
                <div class="canvas-panel">
                    <h2>ä¸‰ç»´äº¤äº’è§†å›¾</h2>
                    <canvas id="divergence-canvas" width="800" height="500"></canvas>
                    
                    <div class="measurement-display">
                        <div class="measurement-title">æµ‹é‡ç»“æœ</div>
                        <div class="measurement-value-container">
                            <div class="measurement-row">
                                <div class="measurement-label">æ•£åº¦å€¼</div>
                                <div class="measurement-value" id="divergence-value">0.00</div>
                            </div>
                            <div class="measurement-unit" id="divergence-unit">å•ä½/ç«‹æ–¹ç±³</div>
                            
                            <div class="measurement-row">
                                <div class="measurement-label">æµå‡ºæ€»é‡</div>
                                <div class="measurement-value" id="outflow-value">0.00</div>
                            </div>
                            <div class="measurement-unit">å•ä½/ç§’</div>
                            
                            <div class="measurement-row">
                                <div class="measurement-label">ç«‹æ–¹ä½“ä½“ç§¯</div>
                                <div class="measurement-value" id="cube-volume-value">8.00</div>
                            </div>
                            <div class="measurement-unit">ç«‹æ–¹ç±³</div>
                        </div>
                    </div>
                    
                    <div class="instructions">
                        <h3>äº¤äº’æŒ‡å—</h3>
                        <ul>
                            <li><strong>æ—‹è½¬è§†å›¾</strong>ï¼šè§¦æ‘¸å¹¶æ‹–æ‹½å¯ä»¥æ—‹è½¬æ•´ä¸ªåœºæ™¯</li>
                            <li><strong>è°ƒæ•´æ°´é¾™å¤´</strong>ï¼šä½¿ç”¨ä¸‹æ–¹æ§åˆ¶é¢æ¿è°ƒæ•´æ°´é¾™å¤´æ˜¯æºï¼ˆå‡ºæ°´ï¼‰è¿˜æ˜¯æ±‡ï¼ˆå¸æ°´ï¼‰</li>
                            <li><strong>è°ƒæ•´å¼ºåº¦</strong>ï¼šæ§åˆ¶æ°´é¾™å¤´å‡ºæ°´/å¸æ°´çš„å¼ºåº¦</li>
                            <li><strong>è§‚å¯Ÿæ•£åº¦</strong>ï¼šè§‚å¯Ÿæ°´æµä»ä¸­å¿ƒç‚¹å‘æ•£ï¼ˆæ­£æ•£åº¦ï¼‰æˆ–å‘ä¸­å¿ƒç‚¹æ±‡èšï¼ˆè´Ÿæ•£åº¦ï¼‰</li>
                            <li><strong>å¯è§†åŒ–é€‰é¡¹</strong>ï¼šä½¿ç”¨ä¸‹æ–¹æŒ‰é’®åˆ‡æ¢ä¸åŒçš„å¯è§†åŒ–æ•ˆæœ</li>
                        </ul>
                    </div>
                    
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #2196f3;"></div>
                            <span>æ°´æµæ–¹å‘</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #ff9800;"></div>
                            <span>æµ‹é‡ç«‹æ–¹ä½“</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #f44336;"></div>
                            <span>æ­£æ•£åº¦ï¼ˆæºï¼Œå‡ºæ°´ï¼‰</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #4caf50;"></div>
                            <span>è´Ÿæ•£åº¦ï¼ˆæ±‡ï¼Œå¸æ°´ï¼‰</span>
                        </div>
                    </div>
                </div>
                
                <div class="control-panel">
                    <h2>æ§åˆ¶é¢æ¿</h2>
                    
                    <h3>æ°´é¾™å¤´æ§åˆ¶</h3>
                    <div class="slider-container">
                        <label for="faucet-strength">æ°´é¾™å¤´å¼ºåº¦ï¼š<span id="faucet-strength-value">1.0</span></label>
                        <input type="range" id="faucet-strength" min="0" max="3" step="0.1" value="1.0">
                    </div>
                    
                    <div class="slider-container">
                        <label for="faucet-direction">æ°´é¾™å¤´æ–¹å‘ï¼š<span id="faucet-direction-value">1.0</span></label>
                        <input type="range" id="faucet-direction" min="-1" max="1" step="0.1" value="1.0">
                    </div>
                    
                    <div class="btn-group">
                        <button id="faucet-source" class="active">æºï¼ˆå‡ºæ°´ï¼Œæ­£æ•£åº¦ï¼‰</button>
                        <button id="faucet-sink">æ±‡ï¼ˆå¸æ°´ï¼Œè´Ÿæ•£åº¦ï¼‰</button>
                        <button id="faucet-off">å…³é—­ï¼ˆé›¶æ•£åº¦ï¼‰</button>
                    </div>
                    
                    <h3>æµ‹é‡ç«‹æ–¹ä½“</h3>
                    <div class="slider-container">
                        <label for="cube-size">ç«‹æ–¹ä½“å¤§å°ï¼š<span id="cube-size-value">2.0</span></label>
                        <input type="range" id="cube-size" min="1" max="4" step="0.1" value="2.0">
                    </div>
                    
                    <div class="btn-group">
                        <button id="cube-small">å°ç«‹æ–¹ä½“</button>
                        <button id="cube-medium">ä¸­ç«‹æ–¹ä½“</button>
                        <button id="cube-large">å¤§ç«‹æ–¹ä½“</button>
                    </div>
                    
                    <h3>å¯è§†åŒ–é€‰é¡¹</h3>
                    <div class="btn-group">
                        <button id="show-vectors" class="active">æ˜¾ç¤ºæ°´æµç®­å¤´</button>
                        <button id="show-cube" class="active">æ˜¾ç¤ºæµ‹é‡ç«‹æ–¹ä½“</button>
                        <button id="show-flowlines">æ˜¾ç¤ºæµçº¿</button>
                    </div>
                    
                    <div class="concept-explanation">
                        <p><strong>æ•£åº¦ï¼ˆDivergenceï¼‰</strong>è¡¨ç¤ºä¸€ä¸ªç‚¹æ˜¯åœºçš„"æº"è¿˜æ˜¯"æ±‡"ã€‚</p>
                        <p>åœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼š</p>
                        <p>â€¢ <strong>æ°´é¾™å¤´</strong>è¡¨ç¤ºç©ºé—´ä¸­çš„ä¸€ä¸ªç‚¹</p>
                        <p>â€¢ <strong>å‡ºæ°´</strong>è¡¨ç¤ºæ­£æ•£åº¦ï¼ˆæºï¼‰</p>
                        <p>â€¢ <strong>å¸æ°´</strong>è¡¨ç¤ºè´Ÿæ•£åº¦ï¼ˆæ±‡ï¼‰</p>
                        <p>â€¢ <strong>å…³é—­</strong>è¡¨ç¤ºé›¶æ•£åº¦</p>
                        <p>â€¢ æ•£åº¦å€¼è¡¨ç¤ºå•ä½ä½“ç§¯å†…äº§ç”Ÿæˆ–æ¶ˆå¤±çš„æµé‡</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ—‹åº¦åœºæ™¯ -->
        <div id="curl-scene" class="scene-container">
            <div class="scene-header">
                <div class="scene-title">æ—‹åº¦æ¨¡å‹ï¼šæ°´é¾™å·ä¸æ¼©æ¶¡</div>
                <div class="scene-icon-large">ğŸŒ€</div>
            </div>
            
            <div class="scene-content">
                <div class="canvas-panel">
                    <h2>ä¸‰ç»´äº¤äº’è§†å›¾</h2>
                    <canvas id="curl-canvas" width="800" height="500"></canvas>
                    
                    <div class="measurement-display">
                        <div class="measurement-title">æµ‹é‡ç»“æœ</div>
                        <div class="measurement-value-container">
                            <div class="measurement-row">
                                <div class="measurement-label">æ—‹åº¦å€¼</div>
                                <div class="measurement-value" id="curl-value">0.00</div>
                            </div>
                            <div class="measurement-unit" id="curl-unit">å•ä½/ç±³</div>
                            
                            <div class="measurement-row">
                                <div class="measurement-label">æ—‹è½¬é€Ÿåº¦</div>
                                <div class="measurement-value" id="rotation-speed-value">0.00</div>
                            </div>
                            <div class="measurement-unit">è½¬/ç§’</div>
                            
                            <div class="measurement-row">
                                <div class="measurement-label">æ¼©æ¶¡åŠå¾„</div>
                                <div class="measurement-value" id="vortex-radius-display">3.00</div>
                            </div>
                            <div class="measurement-unit">ç±³</div>
                        </div>
                    </div>
                    
                    <div class="instructions">
                        <h3>äº¤äº’æŒ‡å—</h3>
                        <ul>
                            <li><strong>æ—‹è½¬è§†å›¾</strong>ï¼šè§¦æ‘¸å¹¶æ‹–æ‹½å¯ä»¥æ—‹è½¬æ•´ä¸ªåœºæ™¯</li>
                            <li><strong>è°ƒæ•´æ¼©æ¶¡</strong>ï¼šä½¿ç”¨ä¸‹æ–¹æ§åˆ¶é¢æ¿è°ƒæ•´æ¼©æ¶¡çš„å¤§å°ã€å¼ºåº¦å’Œæ–¹å‘</li>
                            <li><strong>è°ƒæ•´æµ‹é‡æ†</strong>ï¼šæ§åˆ¶æµ‹é‡æ†ï¼ˆå°é£è½¦ï¼‰çš„å¤§å°å’Œä½ç½®</li>
                            <li><strong>è§‚å¯Ÿæ—‹åº¦</strong>ï¼šè§‚å¯Ÿå°é£è½¦çš„æ—‹è½¬æƒ…å†µï¼Œæ—‹åº¦å€¼è¡¨ç¤ºæ—‹è½¬çš„å¼ºåº¦å’Œæ–¹å‘</li>
                        </ul>
                    </div>
                    
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #2196f3;"></div>
                            <span>æ°´æµæ–¹å‘</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #9c27b0;"></div>
                            <span>æ¼©æ¶¡ä¸­å¿ƒ</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #ff9800;"></div>
                            <span>æµ‹é‡é£è½¦</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #4caf50;"></div>
                            <span>æ­£æ—‹åº¦ï¼ˆé€†æ—¶é’ˆï¼‰</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #f44336;"></div>
                            <span>è´Ÿæ—‹åº¦ï¼ˆé¡ºæ—¶é’ˆï¼‰</span>
                        </div>
                    </div>
                </div>
                
                <div class="control-panel">
                    <h2>æ§åˆ¶é¢æ¿</h2>
                    
                    <h3>æ¼©æ¶¡æ§åˆ¶</h3>
                    <div class="slider-container">
                        <label for="vortex-strength">æ¼©æ¶¡å¼ºåº¦ï¼š<span id="vortex-strength-value">1.0</span></label>
                        <input type="range" id="vortex-strength" min="0" max="3" step="0.1" value="1.0">
                    </div>
                    
                    <div class="slider-container">
                        <label for="vortex-radius">æ¼©æ¶¡åŠå¾„ï¼š<span id="vortex-radius-value">3.0</span></label>
                        <input type="range" id="vortex-radius" min="1" max="5" step="0.1" value="3.0">
                    </div>
                    
                    <div class="slider-container">
                        <label for="vortex-direction">æ¼©æ¶¡æ–¹å‘ï¼š<span id="vortex-direction-value">1.0</span></label>
                        <input type="range" id="vortex-direction" min="-1" max="1" step="0.1" value="1.0">
                    </div>
                    
                    <div class="btn-group">
                        <button id="vortex-clockwise">é¡ºæ—¶é’ˆæ¼©æ¶¡</button>
                        <button id="vortex-counterclockwise" class="active">é€†æ—¶é’ˆæ¼©æ¶¡</button>
                        <button id="vortex-vertical">å‚ç›´æ¼©æ¶¡</button>
                    </div>
                    
                    <h3>æµ‹é‡é£è½¦</h3>
                    <div class="slider-container">
                        <label for="pinwheel-size">é£è½¦å¤§å°ï¼š<span id="pinwheel-size-value">1.0</span></label>
                        <input type="range" id="pinwheel-size" min="0.5" max="2" step="0.1" value="1.0">
                    </div>
                    
                    <div class="slider-container">
                        <label for="pinwheel-position">é£è½¦ä½ç½®ï¼š<span id="pinwheel-position-value">0.0</span></label>
                        <input type="range" id="pinwheel-position" min="-1.5" max="1.5" step="0.1" value="0.0">
                    </div>
                    
                    <div class="btn-group">
                        <button id="pinwheel-center">ä¸­å¿ƒä½ç½®</button>
                        <button id="pinwheel-edge">è¾¹ç¼˜ä½ç½®</button>
                        <button id="pinwheel-outside">å¤–éƒ¨ä½ç½®</button>
                    </div>
                    
                    <div class="concept-explanation">
                        <p><strong>æ—‹åº¦ï¼ˆCurlï¼‰</strong>è¡¨ç¤ºåœºå›´ç»•ä¸€ä¸ªç‚¹çš„æ—‹è½¬è¶‹åŠ¿ã€‚</p>
                        <p>åœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼š</p>
                        <p>â€¢ <strong>æ°´é¾™å·</strong>è¡¨ç¤ºä¸€ä¸ªæœ‰æ—‹åº¦çš„çŸ¢é‡åœº</p>
                        <p>â€¢ <strong>å°é£è½¦</strong>è¡¨ç¤ºæµ‹é‡æ—‹åº¦çš„å·¥å…·</p>
                        <p>â€¢ <strong>é¡ºæ—¶é’ˆ/é€†æ—¶é’ˆ</strong>è¡¨ç¤ºæ—‹åº¦çš„æ–¹å‘</p>
                        <p>â€¢ <strong>æ—‹åº¦å€¼</strong>è¡¨ç¤ºæ—‹è½¬çš„å¼ºåº¦å’Œæ–¹å‘</p>
                        <p>â€¢ é£è½¦è½¬å¾—è¶Šå¿«ï¼Œæ—‹åº¦å€¼è¶Šå¤§</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>ä¸‰ç»´äº¤äº’å¼ç‰©ç†æ¦‚å¿µå­¦ä¹ å·¥å…· | é€šè¿‡ç›´è§‚æ¨¡å‹ç†è§£é€šé‡ã€æ•£åº¦ä¸æ—‹åº¦</p>
            <p style="margin-top: 8px; font-size: 0.75rem; color: #90caf9;">
                æç¤ºï¼šä½¿ç”¨è§¦æ‘¸æ‹–æ‹½æ—‹è½¬ä¸‰ç»´è§†å›¾ï¼Œä½¿ç”¨æ§åˆ¶é¢æ¿è°ƒèŠ‚å‚æ•°ï¼Œè§‚å¯Ÿç‰©ç†é‡çš„å˜åŒ–
            </p>
        </div>
    </div>

    <script>
        // ================ é€šç”¨3Dæ¸²æŸ“å‡½æ•° ================
        
        // 3Dç‚¹ç±»
        class Point3D {
            constructor(x, y, z) {
                this.x = x;
                this.y = y;
                this.z = z;
            }
            
            rotateX(angle) {
                const cos = Math.cos(angle);
                const sin = Math.sin(angle);
                const y = this.y * cos - this.z * sin;
                const z = this.y * sin + this.z * cos;
                return new Point3D(this.x, y, z);
            }
            
            rotateY(angle) {
                const cos = Math.cos(angle);
                const sin = Math.sin(angle);
                const x = this.x * cos + this.z * sin;
                const z = -this.x * sin + this.z * cos;
                return new Point3D(x, this.y, z);
            }
            
            rotateZ(angle) {
                const cos = Math.cos(angle);
                const sin = Math.sin(angle);
                const x = this.x * cos - this.y * sin;
                const y = this.x * sin + this.y * cos;
                return new Point3D(x, y, this.z);
            }
            
            project(canvasWidth, canvasHeight, fov = 800) {
                const scale = fov / (fov + this.z);
                const x = this.x * scale + canvasWidth / 2;
                const y = -this.y * scale + canvasHeight / 2;
                return { x, y, scale };
            }
        }
        
        // 3Då‘é‡ç±»
        class Vector3D {
            constructor(x, y, z) {
                this.x = x;
                this.y = y;
                this.z = z;
            }
            
            length() {
                return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z);
            }
            
            normalize() {
                const len = this.length();
                if (len === 0) return new Vector3D(0, 0, 0);
                return new Vector3D(this.x / len, this.y / len, this.z / len);
            }
            
            dot(v) {
                return this.x * v.x + this.y * v.y + this.z * v.z;
            }
            
            cross(v) {
                return new Vector3D(
                    this.y * v.z - this.z * v.y,
                    this.z * v.x - this.x * v.z,
                    this.x * v.y - this.y * v.x
                );
            }
            
            scale(s) {
                return new Vector3D(this.x * s, this.y * s, this.z * s);
            }
        }
        
        // 3Dåœºæ™¯ç®¡ç†å™¨
        class Scene3D {
            constructor(canvasId) {
                this.canvas = document.getElementById(canvasId);
                this.ctx = this.canvas.getContext('2d');
                this.width = this.canvas.width;
                this.height = this.canvas.height;
                
                // 3Dåœºæ™¯å‚æ•°
                this.camera = {
                    x: 0,
                    y: 0,
                    z: -10,
                    rotationX: -Math.PI / 6,
                    rotationY: Math.PI / 4,
                    rotationZ: 0
                };
                
                // åœºæ™¯ç¼©æ”¾å› å­
                this.scaleFactor = 30;
                
                // è§¦æ‘¸äº¤äº’
                this.isDragging = false;
                this.lastTouchX = 0;
                this.lastTouchY = 0;
                
                // åˆå§‹åŒ–
                this.setupEventListeners();
            }
            
            setupEventListeners() {
                // è§¦æ‘¸å¼€å§‹
                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    if (e.touches.length === 1) {
                        this.isDragging = true;
                        this.lastTouchX = e.touches[0].clientX;
                        this.lastTouchY = e.touches[0].clientY;
                    }
                });
                
                // è§¦æ‘¸ç§»åŠ¨æ—‹è½¬åœºæ™¯
                this.canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    if (!this.isDragging || e.touches.length !== 1) return;
                    
                    const touch = e.touches[0];
                    const deltaX = touch.clientX - this.lastTouchX;
                    const deltaY = touch.clientY - this.lastTouchY;
                    
                    this.camera.rotationY += deltaX * 0.01;
                    this.camera.rotationX += deltaY * 0.01;
                    
                    this.lastTouchX = touch.clientX;
                    this.lastTouchY = touch.clientY;
                    
                    // è§¦å‘é‡ç»˜
                    if (this.onRender) this.onRender();
                });
                
                // è§¦æ‘¸ç»“æŸ
                this.canvas.addEventListener('touchend', () => {
                    this.isDragging = false;
                });
                
                // è§¦æ‘¸å–æ¶ˆ
                this.canvas.addEventListener('touchcancel', () => {
                    this.isDragging = false;
                });
                
                // é¼ æ ‡äº‹ä»¶ï¼ˆæ¡Œé¢ç«¯å…¼å®¹ï¼‰
                this.canvas.addEventListener('mousedown', (e) => {
                    this.isDragging = true;
                    this.lastTouchX = e.clientX;
                    this.lastTouchY = e.clientY;
                });
                
                this.canvas.addEventListener('mousemove', (e) => {
                    if (!this.isDragging) return;
                    
                    const deltaX = e.clientX - this.lastTouchX;
                    const deltaY = e.clientY - this.lastTouchY;
                    
                    this.camera.rotationY += deltaX * 0.01;
                    this.camera.rotationX += deltaY * 0.01;
                    
                    this.lastTouchX = e.clientX;
                    this.lastTouchY = e.clientY;
                    
                    if (this.onRender) this.onRender();
                });
                
                this.canvas.addEventListener('mouseup', () => {
                    this.isDragging = false;
                });
                
                this.canvas.addEventListener('mouseleave', () => {
                    this.isDragging = false;
                });
                
                // è§¦æ‘¸ç¼©æ”¾
                let initialDistance = 0;
                this.canvas.addEventListener('touchstart', (e) => {
                    if (e.touches.length === 2) {
                        const dx = e.touches[0].clientX - e.touches[1].clientX;
                        const dy = e.touches[0].clientY - e.touches[1].clientY;
                        initialDistance = Math.sqrt(dx * dx + dy * dy);
                    }
                });
                
                this.canvas.addEventListener('touchmove', (e) => {
                    if (e.touches.length === 2) {
                        e.preventDefault();
                        const dx = e.touches[0].clientX - e.touches[1].clientX;
                        const dy = e.touches[0].clientY - e.touches[1].clientY;
                        const currentDistance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (initialDistance > 0) {
                            const zoomFactor = currentDistance / initialDistance;
                            this.scaleFactor *= zoomFactor;
                            this.scaleFactor = Math.max(10, Math.min(100, this.scaleFactor));
                            initialDistance = currentDistance;
                            if (this.onRender) this.onRender();
                        }
                    }
                });
                
                // é¼ æ ‡æ»šè½®ç¼©æ”¾
                this.canvas.addEventListener('wheel', (e) => {
                    e.preventDefault();
                    const zoomFactor = e.deltaY > 0 ? 0.9 : 1.1;
                    this.scaleFactor *= zoomFactor;
                    this.scaleFactor = Math.max(10, Math.min(100, this.scaleFactor));
                    if (this.onRender) this.onRender();
                });
            }
            
            // è®¾ç½®æ¸²æŸ“å›è°ƒ
            setRenderCallback(callback) {
                this.onRender = callback;
            }
            
            // æ¸…é™¤ç”»å¸ƒ
            clear() {
                this.ctx.clearRect(0, 0, this.width, this.height);
                
                // ç»˜åˆ¶æ¸å˜èƒŒæ™¯
                const gradient = this.ctx.createLinearGradient(0, 0, 0, this.height);
                gradient.addColorStop(0, '#0a1429');
                gradient.addColorStop(1, '#1a2439');
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(0, 0, this.width, this.height);
            }
            
            // å°†3Dç‚¹è½¬æ¢ä¸º2Då±å¹•åæ ‡ï¼ˆè€ƒè™‘ç¼©æ”¾ï¼‰
            projectPoint(point3D) {
                // åº”ç”¨ç¼©æ”¾
                let point = new Point3D(
                    point3D.x * this.scaleFactor,
                    point3D.y * this.scaleFactor,
                    point3D.z * this.scaleFactor
                );
                
                // åº”ç”¨ç›¸æœºæ—‹è½¬
                point = point.rotateY(this.camera.rotationY);
                point = point.rotateX(this.camera.rotationX);
                point = point.rotateZ(this.camera.rotationZ);
                
                // åº”ç”¨ç›¸æœºå¹³ç§»
                point.x += this.camera.x;
                point.y += this.camera.y;
                point.z += this.camera.z;
                
                // æŠ•å½±åˆ°2D
                return point.project(this.width, this.height);
            }
            
            // ç»˜åˆ¶3Dçº¿æ®µ
            drawLine(p1, p2, color = '#ffffff', width = 1) {
                const proj1 = this.projectPoint(p1);
                const proj2 = this.projectPoint(p2);
                
                // æ£€æŸ¥ç‚¹æ˜¯å¦åœ¨è§†é‡å†…ï¼ˆz>0æ‰å¯è§ï¼‰
                if (proj1.scale <= 0 || proj2.scale <= 0) return;
                
                this.ctx.beginPath();
                this.ctx.moveTo(proj1.x, proj1.y);
                this.ctx.lineTo(proj2.x, proj2.y);
                this.ctx.strokeStyle = color;
                this.ctx.lineWidth = width;
                this.ctx.stroke();
            }
            
            // ç»˜åˆ¶3Dç®­å¤´
            drawArrow(start, end, color = '#ffffff', width = 2, headSize = 10) {
                const projStart = this.projectPoint(start);
                const projEnd = this.projectPoint(end);
                
                // æ£€æŸ¥ç‚¹æ˜¯å¦åœ¨è§†é‡å†…
                if (projStart.scale <= 0 || projEnd.scale <= 0) return;
                
                // ç»˜åˆ¶ç®­æ†
                this.ctx.beginPath();
                this.ctx.moveTo(projStart.x, projStart.y);
                this.ctx.lineTo(projEnd.x, projEnd.y);
                this.ctx.strokeStyle = color;
                this.ctx.lineWidth = width;
                this.ctx.stroke();
                
                // è®¡ç®—ç®­å¤´æ–¹å‘
                const dx = projEnd.x - projStart.x;
                const dy = projEnd.y - projStart.y;
                const length = Math.sqrt(dx * dx + dy * dy);
                
                if (length < 2) return;
                
                const angle = Math.atan2(dy, dx);
                
                // ç»˜åˆ¶ç®­å¤´
                this.ctx.save();
                this.ctx.translate(projEnd.x, projEnd.y);
                this.ctx.rotate(angle);
                
                this.ctx.beginPath();
                this.ctx.moveTo(0, 0);
                this.ctx.lineTo(-headSize, -headSize/2);
                this.ctx.lineTo(-headSize, headSize/2);
                this.ctx.closePath();
                
                this.ctx.fillStyle = color;
                this.ctx.fill();
                
                this.ctx.restore();
            }
            
            // ç»˜åˆ¶3Dç½‘æ ¼
            drawGrid(size = 10, spacing = 2, color = 'rgba(100, 181, 246, 0.3)') {
                for (let i = -size; i <= size; i++) {
                    // Xæ–¹å‘çº¿
                    this.drawLine(
                        new Point3D(i * spacing, -size * spacing, 0),
                        new Point3D(i * spacing, size * spacing, 0),
                        color,
                        0.5
                    );
                    
                    // Yæ–¹å‘çº¿
                    this.drawLine(
                        new Point3D(-size * spacing, i * spacing, 0),
                        new Point3D(size * spacing, i * spacing, 0),
                        color,
                        0.5
                    );
                }
            }
            
            // ç»˜åˆ¶åæ ‡è½´
            drawAxes(length = 5) {
                const origin = new Point3D(0, 0, 0);
                const xEnd = new Point3D(length, 0, 0);
                const yEnd = new Point3D(0, length, 0);
                const zEnd = new Point3D(0, 0, length);
                
                this.drawArrow(origin, xEnd, '#f44336', 3, 12);
                this.drawArrow(origin, yEnd, '#4caf50', 3, 12);
                this.drawArrow(origin, zEnd, '#2196f3', 3, 12);
                
                // ç»˜åˆ¶æ ‡ç­¾
                const projX = this.projectPoint(new Point3D(length + 0.5, 0, 0));
                const projY = this.projectPoint(new Point3D(0, length + 0.5, 0));
                const projZ = this.projectPoint(new Point3D(0, 0, length + 0.5));
                
                if (projX.scale > 0) {
                    this.ctx.fillStyle = '#f44336';
                    this.ctx.font = 'bold 16px Arial';
                    this.ctx.fillText('X', projX.x, projX.y);
                }
                
                if (projY.scale > 0) {
                    this.ctx.fillStyle = '#4caf50';
                    this.ctx.font = 'bold 16px Arial';
                    this.ctx.fillText('Y', projY.x, projY.y);
                }
                
                if (projZ.scale > 0) {
                    this.ctx.fillStyle = '#2196f3';
                    this.ctx.font = 'bold 16px Arial';
                    this.ctx.fillText('Z', projZ.x, projZ.y);
                }
            }
        }
        
        // ================ é€šé‡åœºæ™¯ ================
        
        class FluxScene {
            constructor() {
                this.scene = new Scene3D('flux-canvas');
                this.flowDirection = new Vector3D(0.7, 0.5, 0.3);
                this.flowDensity = 15; // æ°´æµå¯†åº¦ï¼ˆç®­å¤´æ•°é‡ï¼‰
                this.flowPlane = 0.0; // æ°´æµå¹³é¢é«˜åº¦
                this.netSize = 4.0;
                this.netPosition = 0.0; // æ¸”ç½‘ä½ç½®
                this.netRotation = 0; // æ¸”ç½‘æ—‹è½¬è§’åº¦ï¼ˆç»•Zè½´ï¼‰
                this.netRotationX = 0; // æ¸”ç½‘ç»•Xè½´æ—‹è½¬è§’åº¦
                this.netRotationY = 0; // æ¸”ç½‘ç»•Yè½´æ—‹è½¬è§’åº¦
                
                // å­˜å‚¨ç®­å¤´çŠ¶æ€ï¼šæ˜¯å¦æ­£åœ¨ç©¿è¿‡æ¸”ç½‘
                this.arrowStates = [];
                
                // é¢„ç”Ÿæˆå›ºå®šä½ç½®ï¼Œé¿å…é—ªçƒ
                this.fixedPositions = this.generateFixedPositions(100);
                
                // è®¾ç½®æ¸²æŸ“å›è°ƒ
                this.scene.setRenderCallback(() => this.render());
                
                // åˆå§‹æ¸²æŸ“
                this.render();
                
                // è®¾ç½®æ§åˆ¶äº‹ä»¶
                this.setupControls();
            }
            
            generateFixedPositions(count) {
                const positions = [];
                const gridSize = 10;
                const step = gridSize / Math.sqrt(count);
                
                for (let i = 0; i < count; i++) {
                    const x = (i % 10) * step - gridSize/2;
                    const y = Math.floor(i / 10) * step - gridSize/2;
                    positions.push(new Point3D(x, y, 0));
                }
                
                return positions;
            }
            
            setupControls() {
                // æ°´æµå¯†åº¦
                const flowDensityInput = document.getElementById('flow-density');
                flowDensityInput.addEventListener('input', (e) => {
                    this.flowDensity = parseInt(e.target.value);
                    document.getElementById('flow-density-display').textContent = this.flowDensity;
                    document.getElementById('flow-density-value').textContent = this.flowDensity;
                    this.render();
                });
                
                // æ°´æµå¹³é¢é«˜åº¦
                document.getElementById('flow-plane').addEventListener('input', (e) => {
                    this.flowPlane = parseFloat(e.target.value);
                    document.getElementById('flow-plane-display').textContent = this.flowPlane.toFixed(1);
                    this.render();
                });
                
                // æ°´æµæ–¹å‘
                document.getElementById('flow-direction-x').addEventListener('input', (e) => {
                    this.flowDirection.x = parseFloat(e.target.value);
                    document.getElementById('flow-direction-x-value').textContent = this.flowDirection.x.toFixed(1);
                    this.render();
                });
                
                document.getElementById('flow-direction-y').addEventListener('input', (e) => {
                    this.flowDirection.y = parseFloat(e.target.value);
                    document.getElementById('flow-direction-y-value').textContent = this.flowDirection.y.toFixed(1);
                    this.render();
                });
                
                document.getElementById('flow-direction-z').addEventListener('input', (e) => {
                    this.flowDirection.z = parseFloat(e.target.value);
                    document.getElementById('flow-direction-z-value').textContent = this.flowDirection.z.toFixed(1);
                    this.render();
                });
                
                // é¢„è®¾æ°´æµæ–¹å‘
                document.getElementById('flow-horizontal').addEventListener('click', () => {
                    this.flowDirection = new Vector3D(1, 0, 0);
                    this.updateDirectionSliders();
                    this.render();
                });
                
                document.getElementById('flow-vertical').addEventListener('click', () => {
                    this.flowDirection = new Vector3D(0, 1, 0);
                    this.updateDirectionSliders();
                    this.render();
                });
                
                document.getElementById('flow-diagonal').addEventListener('click', () => {
                    this.flowDirection = new Vector3D(0.7, 0.5, 0.3);
                    this.updateDirectionSliders();
                    this.render();
                });
                
                // æ¸”ç½‘å¤§å°
                document.getElementById('net-size').addEventListener('input', (e) => {
                    this.netSize = parseFloat(e.target.value);
                    document.getElementById('net-size-value').textContent = this.netSize.toFixed(1);
                    document.getElementById('net-area-value').textContent = (this.netSize * this.netSize).toFixed(2);
                    this.render();
                });
                
                // æ¸”ç½‘ä½ç½®
                document.getElementById('net-position').addEventListener('input', (e) => {
                    this.netPosition = parseFloat(e.target.value);
                    document.getElementById('net-position-value').textContent = this.netPosition.toFixed(1);
                    this.render();
                });
                
                // æ¸”ç½‘ç»•Zè½´æ—‹è½¬
                document.getElementById('net-rotation-z').addEventListener('input', (e) => {
                    this.netRotation = parseInt(e.target.value);
                    document.getElementById('net-rotation-z-value').textContent = this.netRotation;
                    this.render();
                });
                
                // æ¸”ç½‘ç»•Xè½´æ—‹è½¬
                document.getElementById('net-rotation-x').addEventListener('input', (e) => {
                    this.netRotationX = parseInt(e.target.value);
                    document.getElementById('net-rotation-x-value').textContent = this.netRotationX;
                    this.render();
                });
                
                // æ¸”ç½‘ç»•Yè½´æ—‹è½¬
                document.getElementById('net-rotation-y').addEventListener('input', (e) => {
                    this.netRotationY = parseInt(e.target.value);
                    document.getElementById('net-rotation-y-value').textContent = this.netRotationY;
                    this.render();
                });
                
                // é¢„è®¾æ¸”ç½‘æ–¹å‘
                document.getElementById('net-horizontal').addEventListener('click', () => {
                    this.netRotation = 0;
                    this.netRotationX = 0;
                    this.netRotationY = 0;
                    document.getElementById('net-rotation-z').value = 0;
                    document.getElementById('net-rotation-z-value').textContent = '0';
                    document.getElementById('net-rotation-x').value = 0;
                    document.getElementById('net-rotation-x-value').textContent = '0';
                    document.getElementById('net-rotation-y').value = 0;
                    document.getElementById('net-rotation-y-value').textContent = '0';
                    this.render();
                });
                
                document.getElementById('net-vertical').addEventListener('click', () => {
                    this.netRotation = 90;
                    this.netRotationX = 90;
                    this.netRotationY = 0;
                    document.getElementById('net-rotation-z').value = 90;
                    document.getElementById('net-rotation-z-value').textContent = '90';
                    document.getElementById('net-rotation-x').value = 90;
                    document.getElementById('net-rotation-x-value').textContent = '90';
                    document.getElementById('net-rotation-y').value = 0;
                    document.getElementById('net-rotation-y-value').textContent = '0';
                    this.render();
                });
                
                document.getElementById('net-tilted').addEventListener('click', () => {
                    this.netRotation = 45;
                    this.netRotationX = 45;
                    this.netRotationY = 45;
                    document.getElementById('net-rotation-z').value = 45;
                    document.getElementById('net-rotation-z-value').textContent = '45';
                    document.getElementById('net-rotation-x').value = 45;
                    document.getElementById('net-rotation-x-value').textContent = '45';
                    document.getElementById('net-rotation-y').value = 45;
                    document.getElementById('net-rotation-y-value').textContent = '45';
                    this.render();
                });
                
                document.getElementById('net-reset-angle').addEventListener('click', () => {
                    this.netRotation = 0;
                    this.netRotationX = 0;
                    this.netRotationY = 0;
                    document.getElementById('net-rotation-z').value = 0;
                    document.getElementById('net-rotation-z-value').textContent = '0';
                    document.getElementById('net-rotation-x').value = 0;
                    document.getElementById('net-rotation-x-value').textContent = '0';
                    document.getElementById('net-rotation-y').value = 0;
                    document.getElementById('net-rotation-y-value').textContent = '0';
                    this.render();
                });
            }
            
            updateDirectionSliders() {
                document.getElementById('flow-direction-x').value = this.flowDirection.x;
                document.getElementById('flow-direction-x-value').textContent = this.flowDirection.x.toFixed(1);
                document.getElementById('flow-direction-y').value = this.flowDirection.y;
                document.getElementById('flow-direction-y-value').textContent = this.flowDirection.y.toFixed(1);
                document.getElementById('flow-direction-z').value = this.flowDirection.z;
                document.getElementById('flow-direction-z-value').textContent = this.flowDirection.z.toFixed(1);
            }
            
            render() {
                this.scene.clear();
                this.scene.drawGrid(8, 3);
                this.scene.drawAxes();
                
                // ç»˜åˆ¶æ¸”ç½‘ï¼ˆæµ‹é‡æ›²é¢ï¼‰
                this.drawNet();
                
                // ç»˜åˆ¶æ°´æµ
                this.drawFlow();
                
                // è®¡ç®—å¹¶æ˜¾ç¤ºé€šé‡
                this.calculateAndDisplayFlux();
            }
            
            drawNet() {
                const size = this.netSize;
                const rotationZ = this.netRotation * Math.PI / 180;
                const rotationX = this.netRotationX * Math.PI / 180;
                const rotationY = this.netRotationY * Math.PI / 180;
                const position = this.netPosition;
                
                // åˆ›å»ºæ¸”ç½‘çš„å››ä¸ªè§’ç‚¹
                const corners = [
                    new Point3D(-size/2, -size/2, position),
                    new Point3D(size/2, -size/2, position),
                    new Point3D(size/2, size/2, position),
                    new Point3D(-size/2, size/2, position)
                ];
                
                // åº”ç”¨æ—‹è½¬ï¼ˆç»•Zè½´ã€Xè½´ã€Yè½´ï¼‰
                const rotatedCorners = corners.map(p => {
                    let rotated = p;
                    rotated = rotated.rotateZ(rotationZ);
                    rotated = rotated.rotateX(rotationX);
                    rotated = rotated.rotateY(rotationY);
                    return rotated;
                });
                
                // ç»˜åˆ¶æ¸”ç½‘è¾¹æ¡†
                for (let i = 0; i < 4; i++) {
                    this.scene.drawLine(
                        rotatedCorners[i],
                        rotatedCorners[(i+1)%4],
                        '#f44336',
                        3
                    );
                }
                
                // ç»˜åˆ¶æ¸”ç½‘ç½‘æ ¼çº¿
                const gridLines = Math.max(8, Math.min(16, Math.floor(size)));
                for (let i = 1; i < gridLines; i++) {
                    // æ°´å¹³çº¿
                    const t = i / gridLines;
                    const p1 = new Point3D(
                        -size/2 + size * t,
                        -size/2,
                        position
                    );
                    const p2 = new Point3D(
                        -size/2 + size * t,
                        size/2,
                        position
                    );
                    
                    const rp1 = p1.rotateZ(rotationZ).rotateX(rotationX).rotateY(rotationY);
                    const rp2 = p2.rotateZ(rotationZ).rotateX(rotationX).rotateY(rotationY);
                    
                    this.scene.drawLine(rp1, rp2, 'rgba(244, 67, 54, 0.6)', 1);
                    
                    // å‚ç›´çº¿
                    const p3 = new Point3D(
                        -size/2,
                        -size/2 + size * t,
                        position
                    );
                    const p4 = new Point3D(
                        size/2,
                        -size/2 + size * t,
                        position
                    );
                    
                    const rp3 = p3.rotateZ(rotationZ).rotateX(rotationX).rotateY(rotationY);
                    const rp4 = p4.rotateZ(rotationZ).rotateX(rotationX).rotateY(rotationY);
                    
                    this.scene.drawLine(rp3, rp4, 'rgba(244, 67, 54, 0.6)', 1);
                }
            }
            
            drawFlow() {
                // å½’ä¸€åŒ–æ°´æµæ–¹å‘
                const normDirection = this.flowDirection.normalize();
                
                // æ ¹æ®å¯†åº¦é€‰æ‹©å›ºå®šä½ç½®çš„ä¸€éƒ¨åˆ†
                const numArrows = Math.min(this.flowDensity, this.fixedPositions.length);
                
                // é‡ç½®ç®­å¤´çŠ¶æ€
                this.arrowStates = [];
                
                // è®¡ç®—æ¸”ç½‘æ³•å‘é‡
                const netNormal = this.calculateNetNormal();
                
                for (let i = 0; i < numArrows; i++) {
                    const pos = new Point3D(
                        this.fixedPositions[i].x,
                        this.fixedPositions[i].y,
                        this.flowPlane
                    );
                    
                    // ç®­å¤´é•¿åº¦å›ºå®š
                    const arrowLength = 1.5;
                    const end = new Point3D(
                        pos.x + normDirection.x * arrowLength,
                        pos.y + normDirection.y * arrowLength,
                        pos.z + normDirection.z * arrowLength
                    );
                    
                    // æ£€æŸ¥ç®­å¤´æ˜¯å¦æ­£åœ¨ç©¿è¿‡æ¸”ç½‘
                    const isPassingThrough = this.isArrowPassingThroughNet(pos, end, netNormal);
                    
                    // å­˜å‚¨ç®­å¤´çŠ¶æ€
                    this.arrowStates.push({
                        start: pos,
                        end: end,
                        isPassingThrough: isPassingThrough
                    });
                    
                    // æ ¹æ®æ˜¯å¦ç©¿è¿‡é€‰æ‹©é¢œè‰²
                    const color = isPassingThrough ? '#ff4081' : '#2196f3';
                    
                    this.scene.drawArrow(pos, end, color, 2, 8);
                }
            }
            
            // è®¡ç®—æ¸”ç½‘æ³•å‘é‡
            calculateNetNormal() {
                // åˆå§‹æ³•å‘é‡ä¸º(0,0,1)ï¼ˆå‚ç›´äºXYå¹³é¢ï¼‰
                let normal = new Vector3D(0, 0, 1);
                
                // åº”ç”¨æ—‹è½¬ï¼ˆç»•Zè½´ã€Xè½´ã€Yè½´ï¼‰
                const rotationZ = this.netRotation * Math.PI / 180;
                const rotationX = this.netRotationX * Math.PI / 180;
                const rotationY = this.netRotationY * Math.PI / 180;
                
                // åº”ç”¨æ—‹è½¬é¡ºåºï¼šZè½´ -> Xè½´ -> Yè½´
                let rotatedNormal = normal;
                
                // ç»•Zè½´æ—‹è½¬
                const cosZ = Math.cos(rotationZ);
                const sinZ = Math.sin(rotationZ);
                rotatedNormal = new Vector3D(
                    rotatedNormal.x * cosZ - rotatedNormal.y * sinZ,
                    rotatedNormal.x * sinZ + rotatedNormal.y * cosZ,
                    rotatedNormal.z
                );
                
                // ç»•Xè½´æ—‹è½¬
                const cosX = Math.cos(rotationX);
                const sinX = Math.sin(rotationX);
                rotatedNormal = new Vector3D(
                    rotatedNormal.x,
                    rotatedNormal.y * cosX - rotatedNormal.z * sinX,
                    rotatedNormal.y * sinX + rotatedNormal.z * cosX
                );
                
                // ç»•Yè½´æ—‹è½¬
                const cosY = Math.cos(rotationY);
                const sinY = Math.sin(rotationY);
                rotatedNormal = new Vector3D(
                    rotatedNormal.x * cosY + rotatedNormal.z * sinY,
                    rotatedNormal.y,
                    -rotatedNormal.x * sinY + rotatedNormal.z * cosY
                );
                
                return rotatedNormal.normalize();
            }
            
            // æ£€æŸ¥ç®­å¤´æ˜¯å¦æ­£åœ¨ç©¿è¿‡æ¸”ç½‘
            isArrowPassingThroughNet(start, end, netNormal) {
                // æ¸”ç½‘ä¸­å¿ƒç‚¹
                const netCenter = new Point3D(0, 0, this.netPosition);
                
                // æ£€æŸ¥ç®­å¤´ä¸æ¸”ç½‘å¹³é¢çš„äº¤ç‚¹
                const intersection = this.linePlaneIntersection(start, end, netCenter, netNormal);
                
                if (!intersection) {
                    return false; // æ²¡æœ‰äº¤ç‚¹
                }
                
                // æ£€æŸ¥äº¤ç‚¹æ˜¯å¦åœ¨çº¿æ®µä¸Š
                const t = intersection.t;
                if (t < 0 || t > 1) {
                    return false; // äº¤ç‚¹ä¸åœ¨çº¿æ®µä¸Š
                }
                
                // æ£€æŸ¥äº¤ç‚¹æ˜¯å¦åœ¨æ¸”ç½‘å†…éƒ¨
                const intersectionPoint = intersection.point;
                return this.isPointInsideNet(intersectionPoint);
            }
            
            // è®¡ç®—çº¿æ®µä¸å¹³é¢çš„äº¤ç‚¹
            linePlaneIntersection(start, end, planePoint, planeNormal) {
                const lineDirection = new Vector3D(
                    end.x - start.x,
                    end.y - start.y,
                    end.z - start.z
                );
                
                const denom = planeNormal.dot(lineDirection);
                
                // å¦‚æœçº¿æ®µä¸å¹³é¢å¹³è¡Œ
                if (Math.abs(denom) < 0.0001) {
                    return null;
                }
                
                const planeToStart = new Vector3D(
                    planePoint.x - start.x,
                    planePoint.y - start.y,
                    planePoint.z - start.z
                );
                
                const t = planeNormal.dot(planeToStart) / denom;
                
                // è®¡ç®—äº¤ç‚¹
                const intersectionPoint = new Point3D(
                    start.x + lineDirection.x * t,
                    start.y + lineDirection.y * t,
                    start.z + lineDirection.z * t
                );
                
                return { point: intersectionPoint, t: t };
            }
            
            // æ£€æŸ¥ç‚¹æ˜¯å¦åœ¨æ¸”ç½‘å†…éƒ¨
            isPointInsideNet(point) {
                // å°†ç‚¹è½¬æ¢åˆ°æ¸”ç½‘å±€éƒ¨åæ ‡ç³»
                const rotationZ = -this.netRotation * Math.PI / 180;
                const rotationX = -this.netRotationX * Math.PI / 180;
                const rotationY = -this.netRotationY * Math.PI / 180;
                
                // å…ˆå‡å»æ¸”ç½‘ä½ç½®
                const translatedPoint = new Point3D(
                    point.x,
                    point.y,
                    point.z - this.netPosition
                );
                
                // åå‘æ—‹è½¬
                let rotatedPoint = translatedPoint;
                rotatedPoint = rotatedPoint.rotateY(rotationY);
                rotatedPoint = rotatedPoint.rotateX(rotationX);
                rotatedPoint = rotatedPoint.rotateZ(rotationZ);
                
                // æ£€æŸ¥æ˜¯å¦åœ¨æ¸”ç½‘èŒƒå›´å†…
                const halfSize = this.netSize / 2;
                return Math.abs(rotatedPoint.x) <= halfSize && 
                       Math.abs(rotatedPoint.y) <= halfSize &&
                       Math.abs(rotatedPoint.z) <= 0.1; // å…è®¸ä¸€å®šçš„åšåº¦è¯¯å·®
            }
            
            calculateAndDisplayFlux() {
                // è®¡ç®—æ­£åœ¨ç©¿è¿‡æ¸”ç½‘çš„ç®­å¤´æ•°é‡
                let passingArrowsCount = 0;
                for (const arrow of this.arrowStates) {
                    if (arrow.isPassingThrough) {
                        passingArrowsCount++;
                    }
                }
                
                // å¦‚æœæ²¡æœ‰ç®­å¤´ç©¿è¿‡æ¸”ç½‘ï¼Œé€šé‡ä¸º0
                if (passingArrowsCount === 0) {
                    const fluxValueElement = document.getElementById('flux-value');
                    fluxValueElement.textContent = '0.00';
                    fluxValueElement.style.color = '#00d4ff';
                    document.getElementById('flux-unit').textContent = 'å•ä½/ç§’ (æ— æµé‡ç©¿è¿‡)';
                    return;
                }
                
                // è®¡ç®—é€šé‡ï¼šæ°´æµçŸ¢é‡åœ¨æ¸”ç½‘æ³•å‘é‡ä¸Šçš„æŠ•å½± Ã— æ¸”ç½‘é¢ç§¯ Ã— å¯†åº¦å› å­
                // æ¯ä¸ªç®­å¤´ä»£è¡¨å•ä½æµé‡ï¼Œæ‰€ä»¥æ€»æµé‡ä¸å¯†åº¦æˆæ­£æ¯”
                const densityFactor = this.flowDensity / 15; // ä»¥15ä¸ºåŸºå‡†
                const flowPerArrow = 1.0; // æ¯ä¸ªç®­å¤´ä»£è¡¨çš„æµé‡
                const totalFlow = densityFactor * flowPerArrow;
                
                // è®¡ç®—æ°´æµçŸ¢é‡
                const normDirection = this.flowDirection.normalize();
                const flowVector = normDirection.scale(totalFlow);
                
                // è®¡ç®—æ¸”ç½‘æ³•å‘é‡
                const netNormal = this.calculateNetNormal();
                
                // è®¡ç®—é€šé‡
                const flux = flowVector.dot(netNormal) * (this.netSize * this.netSize);
                
                // æ›´æ–°æ˜¾ç¤º
                const fluxValueElement = document.getElementById('flux-value');
                fluxValueElement.textContent = Math.abs(flux).toFixed(2);
                
                // æ ¹æ®é€šé‡æ­£è´Ÿè®¾ç½®é¢œè‰²å’Œå•ä½
                const fluxUnitElement = document.getElementById('flux-unit');
                if (flux > 0.01) {
                    fluxValueElement.style.color = '#4caf50';
                    fluxUnitElement.textContent = 'å•ä½/ç§’ (æµå‡º)';
                } else if (flux < -0.01) {
                    fluxValueElement.style.color = '#ff9800';
                    fluxUnitElement.textContent = 'å•ä½/ç§’ (æµå…¥)';
                } else {
                    fluxValueElement.style.color = '#00d4ff';
                    fluxUnitElement.textContent = 'å•ä½/ç§’ (å¹³è¡¡)';
                }
            }
        }
        
        // ================ æ•£åº¦åœºæ™¯ ================
        
        class DivergenceScene {
            constructor() {
                this.scene = new Scene3D('divergence-canvas');
                this.faucetStrength = 1.0;
                this.faucetDirection = 1.0; // 1: æºï¼ˆå‡ºæ°´ï¼‰ï¼Œ-1: æ±‡ï¼ˆå¸æ°´ï¼‰
                this.cubeSize = 2.0;
                
                // å¯è§†åŒ–é€‰é¡¹
                this.showVectors = true;
                this.showCube = true;
                this.showFlowlines = false;
                
                // è®¾ç½®æ¸²æŸ“å›è°ƒ
                this.scene.setRenderCallback(() => this.render());
                
                // åˆå§‹æ¸²æŸ“
                this.render();
                
                // è®¾ç½®æ§åˆ¶äº‹ä»¶
                this.setupControls();
            }
            
            setupControls() {
                // æ°´é¾™å¤´å¼ºåº¦
                document.getElementById('faucet-strength').addEventListener('input', (e) => {
                    this.faucetStrength = parseFloat(e.target.value);
                    document.getElementById('faucet-strength-value').textContent = this.faucetStrength.toFixed(1);
                    this.render();
                });
                
                // æ°´é¾™å¤´æ–¹å‘
                document.getElementById('faucet-direction').addEventListener('input', (e) => {
                    this.faucetDirection = parseFloat(e.target.value);
                    document.getElementById('faucet-direction-value').textContent = this.faucetDirection.toFixed(1);
                    this.updateFaucetButtons();
                    this.render();
                });
                
                // æ°´é¾™å¤´é¢„è®¾
                document.getElementById('faucet-source').addEventListener('click', () => {
                    this.faucetDirection = 1.0;
                    document.getElementById('faucet-direction').value = 1.0;
                    document.getElementById('faucet-direction-value').textContent = '1.0';
                    this.updateFaucetButtons();
                    this.render();
                });
                
                document.getElementById('faucet-sink').addEventListener('click', () => {
                    this.faucetDirection = -1.0;
                    document.getElementById('faucet-direction').value = -1.0;
                    document.getElementById('faucet-direction-value').textContent = '-1.0';
                    this.updateFaucetButtons();
                    this.render();
                });
                
                document.getElementById('faucet-off').addEventListener('click', () => {
                    this.faucetDirection = 0;
                    document.getElementById('faucet-direction').value = 0;
                    document.getElementById('faucet-direction-value').textContent = '0.0';
                    this.updateFaucetButtons();
                    this.render();
                });
                
                // ç«‹æ–¹ä½“å¤§å°
                document.getElementById('cube-size').addEventListener('input', (e) => {
                    this.cubeSize = parseFloat(e.target.value);
                    document.getElementById('cube-size-value').textContent = this.cubeSize.toFixed(1);
                    document.getElementById('cube-volume-value').textContent = (this.cubeSize * this.cubeSize * this.cubeSize).toFixed(2);
                    this.render();
                });
                
                // ç«‹æ–¹ä½“é¢„è®¾
                document.getElementById('cube-small').addEventListener('click', () => {
                    this.cubeSize = 1.0;
                    document.getElementById('cube-size').value = 1.0;
                    document.getElementById('cube-size-value').textContent = '1.0';
                    document.getElementById('cube-volume-value').textContent = '1.00';
                    this.render();
                });
                
                document.getElementById('cube-medium').addEventListener('click', () => {
                    this.cubeSize = 2.0;
                    document.getElementById('cube-size').value = 2.0;
                    document.getElementById('cube-size-value').textContent = '2.0';
                    document.getElementById('cube-volume-value').textContent = '8.00';
                    this.render();
                });
                
                document.getElementById('cube-large').addEventListener('click', () => {
                    this.cubeSize = 3.0;
                    document.getElementById('cube-size').value = 3.0;
                    document.getElementById('cube-size-value').textContent = '3.0';
                    document.getElementById('cube-volume-value').textContent = '27.00';
                    this.render();
                });
                
                // å¯è§†åŒ–é€‰é¡¹
                document.getElementById('show-vectors').addEventListener('click', () => {
                    this.showVectors = !this.showVectors;
                    this.updateVisualizationButtons();
                    this.render();
                });
                
                document.getElementById('show-cube').addEventListener('click', () => {
                    this.showCube = !this.showCube;
                    this.updateVisualizationButtons();
                    this.render();
                });
                
                document.getElementById('show-flowlines').addEventListener('click', () => {
                    this.showFlowlines = !this.showFlowlines;
                    this.updateVisualizationButtons();
                    this.render();
                });
                
                // åˆå§‹åŒ–æŒ‰é’®çŠ¶æ€
                this.updateVisualizationButtons();
            }
            
            updateFaucetButtons() {
                document.getElementById('faucet-source').classList.remove('active');
                document.getElementById('faucet-sink').classList.remove('active');
                document.getElementById('faucet-off').classList.remove('active');
                
                if (this.faucetDirection > 0.5) {
                    document.getElementById('faucet-source').classList.add('active');
                } else if (this.faucetDirection < -0.5) {
                    document.getElementById('faucet-sink').classList.add('active');
                } else {
                    document.getElementById('faucet-off').classList.add('active');
                }
            }
            
            updateVisualizationButtons() {
                document.getElementById('show-vectors').classList.toggle('active', this.showVectors);
                document.getElementById('show-cube').classList.toggle('active', this.showCube);
                document.getElementById('show-flowlines').classList.toggle('active', this.showFlowlines);
            }
            
            render() {
                this.scene.clear();
                this.scene.drawGrid(8, 3);
                this.scene.drawAxes();
                
                // ç»˜åˆ¶æµ‹é‡ç«‹æ–¹ä½“
                if (this.showCube) {
                    this.drawCube();
                }
                
                // ç»˜åˆ¶æ°´æµ
                if (this.showVectors) {
                    this.drawFlow();
                }
                
                // ç»˜åˆ¶æµçº¿ï¼ˆå¦‚æœå¯ç”¨ï¼‰
                if (this.showFlowlines) {
                    this.drawFlowlines();
                }
                
                // è®¡ç®—å¹¶æ˜¾ç¤ºæ•£åº¦
                this.calculateAndDisplayDivergence();
            }
            
            drawCube() {
                const size = this.cubeSize;
                const half = size / 2;
                
                // ç«‹æ–¹ä½“çš„8ä¸ªé¡¶ç‚¹
                const vertices = [
                    new Point3D(-half, -half, -half),
                    new Point3D(half, -half, -half),
                    new Point3D(half, half, -half),
                    new Point3D(-half, half, -half),
                    new Point3D(-half, -half, half),
                    new Point3D(half, -half, half),
                    new Point3D(half, half, half),
                    new Point3D(-half, half, half)
                ];
                
                // ç»˜åˆ¶12æ¡è¾¹
                const edges = [
                    [0,1], [1,2], [2,3], [3,0], // å‰é¢
                    [4,5], [5,6], [6,7], [7,4], // åé¢
                    [0,4], [1,5], [2,6], [3,7]  // è¿æ¥çº¿
                ];
                
                edges.forEach(edge => {
                    this.scene.drawLine(
                        vertices[edge[0]],
                        vertices[edge[1]],
                        '#ff9800',
                        2
                    );
                });
            }
            
            drawFlow() {
                const center = new Point3D(0, 0, 0);
                const strength = this.faucetStrength;
                const direction = this.faucetDirection;
                
                // ç»˜åˆ¶ä¸­å¿ƒç‚¹ï¼ˆæ°´é¾™å¤´ï¼‰
                const centerProj = this.scene.projectPoint(center);
                if (centerProj.scale > 0) {
                    this.scene.ctx.beginPath();
                    this.scene.ctx.arc(centerProj.x, centerProj.y, 10, 0, Math.PI * 2);
                    this.scene.ctx.fillStyle = direction > 0 ? '#f44336' : '#4caf50';
                    this.scene.ctx.fill();
                    
                    // ç»˜åˆ¶ä¸­å¿ƒç‚¹æ ‡ç­¾
                    this.scene.ctx.fillStyle = '#ffffff';
                    this.scene.ctx.font = 'bold 14px Arial';
                    this.scene.ctx.textAlign = 'center';
                    this.scene.ctx.fillText(direction > 0 ? 'æº' : 'æ±‡', centerProj.x, centerProj.y - 15);
                }
                
                // ç»˜åˆ¶ä»ä¸­å¿ƒå‘å‡ºçš„ç®­å¤´
                const numArrows = 20;
                for (let i = 0; i < numArrows; i++) {
                    // çƒé¢å‡åŒ€åˆ†å¸ƒ
                    const phi = Math.acos(1 - 2 * i / numArrows);
                    const theta = Math.PI * (1 + Math.sqrt(5)) * i; // é»„é‡‘è§’
                    
                    // çƒé¢åæ ‡è½¬ç›´è§’åæ ‡
                    const x = Math.sin(phi) * Math.cos(theta);
                    const y = Math.sin(phi) * Math.sin(theta);
                    const z = Math.cos(phi);
                    
                    // ç®­å¤´é•¿åº¦ä¸å¼ºåº¦ç›¸å…³
                    const arrowLength = strength * 3;
                    
                    let start, end;
                    
                    if (direction > 0) {
                        // æºï¼šç®­å¤´ä»ä¸­å¿ƒæŒ‡å‘å¤–
                        start = center;
                        end = new Point3D(
                            center.x + x * arrowLength * direction,
                            center.y + y * arrowLength * direction,
                            center.z + z * arrowLength * direction
                        );
                    } else if (direction < 0) {
                        // æ±‡ï¼šç®­å¤´ä»å¤–æŒ‡å‘ä¸­å¿ƒ
                        const distance = 5; // ç®­å¤´èµ·ç‚¹è·ç¦»ä¸­å¿ƒçš„è·ç¦»
                        start = new Point3D(
                            center.x + x * distance,
                            center.y + y * distance,
                            center.z + z * distance
                        );
                        end = center; // ç®­å¤´æŒ‡å‘ä¸­å¿ƒ
                    } else {
                        // æ–¹å‘ä¸º0ï¼Œä¸ç»˜åˆ¶ç®­å¤´
                        continue;
                    }
                    
                    // ç»˜åˆ¶ç®­å¤´
                    this.scene.drawArrow(start, end, '#2196f3', 2, 10);
                }
            }
            
            drawFlowlines() {
                const center = new Point3D(0, 0, 0);
                const strength = this.faucetStrength;
                const direction = this.faucetDirection;
                
                // ç»˜åˆ¶æµçº¿ï¼ˆè¿ç»­æ›²çº¿ï¼‰
                const numLines = 8;
                for (let i = 0; i < numLines; i++) {
                    const angle = (i * 2 * Math.PI) / numLines;
                    const radius = 5;
                    
                    if (direction > 0) {
                        // æºï¼šä»ä¸­å¿ƒå‘å¤–è¾å°„çš„æµçº¿
                        const start = center;
                        const end = new Point3D(
                            Math.cos(angle) * radius * direction,
                            Math.sin(angle) * radius * direction,
                            0
                        );
                        
                        // ç»˜åˆ¶æµçº¿
                        this.scene.drawArrow(start, end, '#9c27b0', 1.5, 6);
                    } else if (direction < 0) {
                        // æ±‡ï¼šå‘ä¸­å¿ƒæ±‡èšçš„æµçº¿
                        const start = new Point3D(
                            Math.cos(angle) * radius,
                            Math.sin(angle) * radius,
                            0
                        );
                        const end = center;
                        
                        // ç»˜åˆ¶æµçº¿
                        this.scene.drawArrow(start, end, '#9c27b0', 1.5, 6);
                    }
                }
            }
            
            calculateAndDisplayDivergence() {
                // æ•£åº¦ = æµå‡ºæ€»é‡ / ä½“ç§¯
                // å¯¹äºç‚¹æº/æ±‡ï¼Œæµå‡ºæ€»é‡ = å¼ºåº¦ Ã— æ–¹å‘ Ã— çƒé¢é¢ç§¯å› å­
                const outflow = this.faucetStrength * this.faucetDirection * 4 * Math.PI;
                const volume = this.cubeSize * this.cubeSize * this.cubeSize;
                const divergence = outflow / volume;
                
                // æ›´æ–°æ˜¾ç¤º
                const divergenceValueElement = document.getElementById('divergence-value');
                divergenceValueElement.textContent = Math.abs(divergence).toFixed(2);
                
                const outflowValueElement = document.getElementById('outflow-value');
                outflowValueElement.textContent = Math.abs(outflow).toFixed(2);
                
                // æ ¹æ®æ•£åº¦æ­£è´Ÿè®¾ç½®é¢œè‰²å’Œå•ä½
                const divergenceUnitElement = document.getElementById('divergence-unit');
                if (divergence > 0.01) {
                    divergenceValueElement.style.color = '#f44336';
                    divergenceUnitElement.textContent = 'å•ä½/ç«‹æ–¹ç±³ (æº)';
                } else if (divergence < -0.01) {
                    divergenceValueElement.style.color = '#4caf50';
                    divergenceUnitElement.textContent = 'å•ä½/ç«‹æ–¹ç±³ (æ±‡)';
                } else {
                    divergenceValueElement.style.color = '#00d4ff';
                    divergenceUnitElement.textContent = 'å•ä½/ç«‹æ–¹ç±³ (å¹³è¡¡)';
                }
            }
        }
        
        // ================ æ—‹åº¦åœºæ™¯ ================
        
        class CurlScene {
            constructor() {
                this.scene = new Scene3D('curl-canvas');
                this.vortexStrength = 1.0;
                this.vortexRadius = 3.0;
                this.vortexDirection = 1.0; // 1: é€†æ—¶é’ˆï¼Œ-1: é¡ºæ—¶é’ˆ
                this.pinwheelSize = 1.0;
                this.pinwheelPosition = 0.0; // -1: å·¦ï¼Œ0: ä¸­å¿ƒï¼Œ1: å³
                this.pinwheelRotation = 0;
                
                // è®¾ç½®æ¸²æŸ“å›è°ƒ
                this.scene.setRenderCallback(() => this.render());
                
                // åˆå§‹æ¸²æŸ“
                this.render();
                
                // è®¾ç½®æ§åˆ¶äº‹ä»¶
                this.setupControls();
                
                // åŠ¨ç”»å¾ªç¯
                this.animate();
            }
            
            setupControls() {
                // æ¼©æ¶¡å¼ºåº¦
                document.getElementById('vortex-strength').addEventListener('input', (e) => {
                    this.vortexStrength = parseFloat(e.target.value);
                    document.getElementById('vortex-strength-value').textContent = this.vortexStrength.toFixed(1);
                    this.render();
                });
                
                // æ¼©æ¶¡åŠå¾„
                document.getElementById('vortex-radius').addEventListener('input', (e) => {
                    this.vortexRadius = parseFloat(e.target.value);
                    document.getElementById('vortex-radius-value').textContent = this.vortexRadius.toFixed(1);
                    document.getElementById('vortex-radius-display').textContent = this.vortexRadius.toFixed(2);
                    this.render();
                });
                
                // æ¼©æ¶¡æ–¹å‘
                document.getElementById('vortex-direction').addEventListener('input', (e) => {
                    this.vortexDirection = parseFloat(e.target.value);
                    document.getElementById('vortex-direction-value').textContent = this.vortexDirection.toFixed(1);
                    this.updateVortexButtons();
                    this.render();
                });
                
                // æ¼©æ¶¡é¢„è®¾
                document.getElementById('vortex-clockwise').addEventListener('click', () => {
                    this.vortexDirection = -1.0;
                    document.getElementById('vortex-direction').value = -1.0;
                    document.getElementById('vortex-direction-value').textContent = '-1.0';
                    this.updateVortexButtons();
                    this.render();
                });
                
                document.getElementById('vortex-counterclockwise').addEventListener('click', () => {
                    this.vortexDirection = 1.0;
                    document.getElementById('vortex-direction').value = 1.0;
                    document.getElementById('vortex-direction-value').textContent = '1.0';
                    this.updateVortexButtons();
                    this.render();
                });
                
                document.getElementById('vortex-vertical').addEventListener('click', () => {
                    this.vortexDirection = 0;
                    document.getElementById('vortex-direction').value = 0;
                    document.getElementById('vortex-direction-value').textContent = '0.0';
                    this.updateVortexButtons();
                    this.render();
                });
                
                // é£è½¦å¤§å°
                document.getElementById('pinwheel-size').addEventListener('input', (e) => {
                    this.pinwheelSize = parseFloat(e.target.value);
                    document.getElementById('pinwheel-size-value').textContent = this.pinwheelSize.toFixed(1);
                    this.render();
                });
                
                // é£è½¦ä½ç½®
                document.getElementById('pinwheel-position').addEventListener('input', (e) => {
                    this.pinwheelPosition = parseFloat(e.target.value);
                    document.getElementById('pinwheel-position-value').textContent = this.pinwheelPosition.toFixed(1);
                    this.updatePinwheelButtons();
                    this.render();
                });
                
                // é£è½¦é¢„è®¾ä½ç½®
                document.getElementById('pinwheel-center').addEventListener('click', () => {
                    this.pinwheelPosition = 0.0;
                    document.getElementById('pinwheel-position').value = 0.0;
                    document.getElementById('pinwheel-position-value').textContent = '0.0';
                    this.updatePinwheelButtons();
                    this.render();
                });
                
                document.getElementById('pinwheel-edge').addEventListener('click', () => {
                    this.pinwheelPosition = 1.0;
                    document.getElementById('pinwheel-position').value = 1.0;
                    document.getElementById('pinwheel-position-value').textContent = '1.0';
                    this.updatePinwheelButtons();
                    this.render();
                });
                
                document.getElementById('pinwheel-outside').addEventListener('click', () => {
                    this.pinwheelPosition = 1.5;
                    document.getElementById('pinwheel-position').value = 1.5;
                    document.getElementById('pinwheel-position-value').textContent = '1.5';
                    this.updatePinwheelButtons();
                    this.render();
                });
            }
            
            updateVortexButtons() {
                document.getElementById('vortex-clockwise').classList.remove('active');
                document.getElementById('vortex-counterclockwise').classList.remove('active');
                document.getElementById('vortex-vertical').classList.remove('active');
                
                if (this.vortexDirection > 0.5) {
                    document.getElementById('vortex-counterclockwise').classList.add('active');
                } else if (this.vortexDirection < -0.5) {
                    document.getElementById('vortex-clockwise').classList.add('active');
                } else {
                    document.getElementById('vortex-vertical').classList.add('active');
                }
            }
            
            updatePinwheelButtons() {
                document.getElementById('pinwheel-center').classList.remove('active');
                document.getElementById('pinwheel-edge').classList.remove('active');
                document.getElementById('pinwheel-outside').classList.remove('active');
                
                if (Math.abs(this.pinwheelPosition) < 0.3) {
                    document.getElementById('pinwheel-center').classList.add('active');
                } else if (Math.abs(this.pinwheelPosition) < 1.2) {
                    document.getElementById('pinwheel-edge').classList.add('active');
                } else {
                    document.getElementById('pinwheel-outside').classList.add('active');
                }
            }
            
            render() {
                this.scene.clear();
                this.scene.drawGrid(8, 3);
                this.scene.drawAxes();
                
                // ç»˜åˆ¶æ¼©æ¶¡
                this.drawVortex();
                
                // ç»˜åˆ¶æµ‹é‡é£è½¦
                this.drawPinwheel();
                
                // è®¡ç®—å¹¶æ˜¾ç¤ºæ—‹åº¦
                this.calculateAndDisplayCurl();
            }
            
            drawVortex() {
                const center = new Point3D(0, 0, 0);
                const radius = this.vortexRadius;
                const strength = this.vortexStrength;
                const direction = this.vortexDirection;
                
                // ç»˜åˆ¶æ¼©æ¶¡ä¸­å¿ƒ
                const centerProj = this.scene.projectPoint(center);
                if (centerProj.scale > 0) {
                    this.scene.ctx.beginPath();
                    this.scene.ctx.arc(centerProj.x, centerProj.y, 12, 0, Math.PI * 2);
                    this.scene.ctx.fillStyle = '#9c27b0';
                    this.scene.ctx.fill();
                    
                    // ç»˜åˆ¶ä¸­å¿ƒç‚¹æ ‡ç­¾
                    this.scene.ctx.fillStyle = '#ffffff';
                    this.scene.ctx.font = 'bold 14px Arial';
                    this.scene.ctx.textAlign = 'center';
                    this.scene.ctx.fillText('æ¼©æ¶¡ä¸­å¿ƒ', centerProj.x, centerProj.y - 20);
                }
                
                // ç»˜åˆ¶æ¼©æ¶¡æµçº¿
                const numLayers = 3;
                for (let layer = 0; layer < numLayers; layer++) {
                    const layerRadius = radius * (0.3 + layer * 0.35);
                    const numStreams = 8 + layer * 4;
                    
                    for (let i = 0; i < numStreams; i++) {
                        const angle = (i * 2 * Math.PI) / numStreams;
                        const segmentAngle = -direction * 0.8; // ä¿®æ­£æ–¹å‘æ˜¾ç¤ºï¼Œä½¿æ§åˆ¶é¢æ¿ä¸è§†å›¾ä¸€è‡´
                        
                        // æµçº¿èµ·ç‚¹
                        const start = new Point3D(
                            layerRadius * Math.cos(angle),
                            layerRadius * Math.sin(angle),
                            0
                        );
                        
                        // æµçº¿ç»ˆç‚¹
                        const endAngle = angle + segmentAngle;
                        const end = new Point3D(
                            layerRadius * Math.cos(endAngle),
                            layerRadius * Math.sin(endAngle),
                            0
                        );
                        
                        // æ ¹æ®å±‚æ•°è®¾ç½®ä¸åŒçš„é€æ˜åº¦
                        const alpha = 0.3 + layer * 0.2;
                        const color = `rgba(33, 150, 243, ${alpha})`;
                        
                        this.scene.drawArrow(start, end, color, 2, 8);
                    }
                }
                
                // ç»˜åˆ¶æ¼©æ¶¡è¾¹ç•Œ
                const numPoints = 48;
                const points = [];
                for (let i = 0; i < numPoints; i++) {
                    const angle = (i * 2 * Math.PI) / numPoints;
                    points.push(new Point3D(
                        radius * Math.cos(angle),
                        radius * Math.sin(angle),
                        0
                    ));
                }
                
                for (let i = 0; i < numPoints; i++) {
                    this.scene.drawLine(
                        points[i],
                        points[(i+1) % numPoints],
                        'rgba(156, 39, 176, 0.6)',
                        2
                    );
                }
            }
            
            drawPinwheel() {
                const size = this.pinwheelSize * 0.5;
                const position = this.pinwheelPosition * this.vortexRadius;
                const center = new Point3D(position, 0, 0);
                
                // ç»˜åˆ¶é£è½¦ä¸­å¿ƒ
                const centerProj = this.scene.projectPoint(center);
                if (centerProj.scale > 0) {
                    this.scene.ctx.beginPath();
                    this.scene.ctx.arc(centerProj.x, centerProj.y, 8, 0, Math.PI * 2);
                    this.scene.ctx.fillStyle = '#ff9800';
                    this.scene.ctx.fill();
                    
                    // ç»˜åˆ¶é£è½¦æ ‡ç­¾
                    this.scene.ctx.fillStyle = '#ffffff';
                    this.scene.ctx.font = 'bold 12px Arial';
                    this.scene.ctx.textAlign = 'center';
                    this.scene.ctx.fillText('æµ‹é‡é£è½¦', centerProj.x, centerProj.y - 15);
                }
                
                // ç»˜åˆ¶é£è½¦å¶ç‰‡
                const numBlades = 4;
                for (let i = 0; i < numBlades; i++) {
                    const angle = this.pinwheelRotation + (i * 2 * Math.PI) / numBlades;
                    
                    const end = new Point3D(
                        center.x + Math.cos(angle) * size,
                        center.y + Math.sin(angle) * size,
                        center.z
                    );
                    
                    this.scene.drawLine(center, end, '#ff9800', 3);
                    
                    // ç»˜åˆ¶å¶ç‰‡ç®­å¤´
                    const tip = new Point3D(
                        center.x + Math.cos(angle) * size * 1.3,
                        center.y + Math.sin(angle) * size * 1.3,
                        center.z
                    );
                    
                    this.scene.drawArrow(end, tip, '#ff9800', 2, 8);
                }
            }
            
            calculateAndDisplayCurl() {
                // æ—‹åº¦ = è§’é€Ÿåº¦ Ã— ä½ç½®å› å­ Ã— åŠå¾„å› å­
                const angularVelocity = this.vortexStrength * this.vortexDirection;
                
                // ä½ç½®å› å­ï¼šä¸­å¿ƒæœ€å¤§ï¼Œè¾¹ç¼˜å‡å°ï¼Œå¤–éƒ¨æ¥è¿‘é›¶
                let positionFactor;
                const absPos = Math.abs(this.pinwheelPosition);
                if (absPos < 0.5) {
                    positionFactor = 1.0;
                } else if (absPos < 1.0) {
                    positionFactor = 1.0 - (absPos - 0.5) * 2;
                } else {
                    positionFactor = 0.1;
                }
                
                // åŠå¾„å› å­ï¼šåŠå¾„è¶Šå¤§ï¼Œæ—‹åº¦å€¼è¶Šå°ï¼ˆä½¿ç”¨åæ¯”å…³ç³»ï¼‰
                // å½“åŠå¾„=1æ—¶å› å­ä¸º1ï¼ŒåŠå¾„=5æ—¶å› å­ä¸º0.2
                const radiusFactor = 1.0 / (this.vortexRadius);
                
                const curl = angularVelocity * positionFactor * radiusFactor;
                
                // æ—‹è½¬é€Ÿåº¦ï¼ˆç”¨äºåŠ¨ç”»ï¼‰
                const rotationSpeed = angularVelocity * positionFactor * radiusFactor * 3;
                
                // æ›´æ–°æ˜¾ç¤º
                const curlValueElement = document.getElementById('curl-value');
                curlValueElement.textContent = Math.abs(curl).toFixed(2);
                
                const rotationSpeedElement = document.getElementById('rotation-speed-value');
                rotationSpeedElement.textContent = Math.abs(rotationSpeed).toFixed(2);
                
                // æ ¹æ®æ—‹åº¦æ­£è´Ÿè®¾ç½®é¢œè‰²å’Œå•ä½
                const curlUnitElement = document.getElementById('curl-unit');
                if (curl > 0.01) {
                    curlValueElement.style.color = '#4caf50';
                    curlUnitElement.textContent = 'å•ä½/ç±³ (é€†æ—¶é’ˆ)';
                } else if (curl < -0.01) {
                    curlValueElement.style.color = '#f44336';
                    curlUnitElement.textContent = 'å•ä½/ç±³ (é¡ºæ—¶é’ˆ)';
                } else {
                    curlValueElement.style.color = '#00d4ff';
                    curlUnitElement.textContent = 'å•ä½/ç±³ (æ— æ—‹è½¬)';
                }
                
                return rotationSpeed;
            }
            
            animate() {
                // æ›´æ–°é£è½¦æ—‹è½¬
                const rotationSpeed = this.calculateAndDisplayCurl();
                this.pinwheelRotation += rotationSpeed * 0.05;
                
                // é‡æ–°æ¸²æŸ“
                this.render();
                
                // ç»§ç»­åŠ¨ç”»å¾ªç¯
                requestAnimationFrame(() => this.animate());
            }
        }
        
        // ================ åœºæ™¯åˆ‡æ¢ ================
        
        let currentScene = 'flux';
        let fluxScene, divergenceScene, curlScene;
        
        function initScenes() {
            fluxScene = new FluxScene();
            divergenceScene = new DivergenceScene();
            curlScene = new CurlScene();
        }
        
        function switchScene(sceneName) {
            // æ›´æ–°åœºæ™¯æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.scene-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(`scene-${sceneName}`).classList.add('active');
            
            // æ›´æ–°åœºæ™¯å®¹å™¨æ˜¾ç¤º
            document.querySelectorAll('.scene-container').forEach(container => {
                container.classList.remove('active');
            });
            
            document.getElementById(`${sceneName}-scene`).classList.add('active');
            
            currentScene = sceneName;
        }
        
        // ================ åˆå§‹åŒ– ================
        
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–åœºæ™¯
            initScenes();
            
            // è®¾ç½®åœºæ™¯åˆ‡æ¢äº‹ä»¶
            document.getElementById('scene-flux').addEventListener('click', () => switchScene('flux'));
            document.getElementById('scene-divergence').addEventListener('click', () => switchScene('divergence'));
            document.getElementById('scene-curl').addEventListener('click', () => switchScene('curl'));
        });
    </script>
</body>
</html>